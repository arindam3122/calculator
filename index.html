<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Savings Calculator — Responsive</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{
  --bg1:#dbeafe; --bg2:#e0f2fe; --accent:#2563eb; --card:rgba(255,255,255,0.95);
  --muted:#64748b; --green:#16a34a; --red:#ef4444; --soft:#f8fafc;
}

body{
  font-family:Inter,system-ui;
  margin:0;
  background:linear-gradient(135deg,var(--bg1),var(--bg2));
}

.wrap{max-width:1000px;margin:28px auto;padding:16px;}
.card{
  background:var(--card);
  border-radius:14px;
  padding:16px;
  box-shadow:0 10px 30px rgba(2,6,23,.08);
}

h1{
  text-align:center;
  margin:0 0 16px;
  color:#0f172a;
  font-size:22px;
}

/* Form Grid */
.form-grid{
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:12px;
  background:var(--soft);
  padding:14px;
  border-radius:12px;
  margin-bottom:14px;
}
.field{display:flex;flex-direction:column;}
label{font-size:13px;color:var(--muted);}
input,select{
  padding:10px;
  border-radius:10px;
  border:1px solid #e6eef8;
  font-size:14px;
}

.btn{
  padding:11px 14px;
  border-radius:10px;
  font-weight:600;
  border:none;
  cursor:pointer;
}
.btn-primary{
  background:var(--accent);
  color:white;
  grid-column:span 4;
}
.small-btn{
  padding:8px 10px;
  border-radius:8px;
  font-weight:700;
  border:none;
}

.btn-edit{
  background:#f97316;
  color:white;
  margin-right:10px; /* ADDED SPACING */
}

.btn-delete{
  background:#ef4444;
  color:white;
}

/* Table */
.table-wrap{margin-top:18px;overflow-x:auto;}
table{
  width:100%;
  border-collapse:collapse;
  border-radius:10px;
  overflow:hidden;
  box-shadow:0 6px 20px rgba(2,6,23,.06);
}
thead th{
  background:#1e3a8a;
  color:white;
  padding:12px;
  font-size:13px;
}
tbody td{
  padding:12px;
  border-bottom:1px solid #eef2ff;
  font-size:14px;
  text-align:center;
}

/* Color-coded numbers */
.credit { color:var(--green); font-weight:700; }
.debit { color:var(--red); font-weight:700; }
.total-positive { color:var(--green); font-weight:800; }
.total-negative { color:var(--red); font-weight:800; }
.total-zero { color:#6b7280; font-weight:700; }

/* Report box */
.report{
  margin-top:16px;
  padding:14px;
  border-left:6px solid #0284c7;
  background:#e6f7ff;
  border-radius:10px;
  font-size:14px;
}

/* Graph */
.graph-panel{
  margin-top:16px;
  padding:14px;
  border-radius:12px;
  background:white;
  box-shadow:0 8px 30px rgba(2,6,23,.06);
  display:none;
}
.tabs{display:flex;gap:8px;}
.tab{
  padding:8px 12px;
  border-radius:8px;
  background:#f1f5f9;
  cursor:pointer;
  font-weight:700;
}
.tab.active{
  background:var(--accent);
  color:white;
}
.chart-container{
  position:relative;
  height:300px;
}

/* Modal */
.modal-backdrop{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.45);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:1000;
}
.modal{
  background:white;
  padding:16px;
  border-radius:12px;
  width:90%;
  max-width:420px;
}

/* Responsive */
@media(max-width:880px){
  .form-grid{grid-template-columns:repeat(2,1fr);}
  .btn-primary{grid-column:span 2;}
}
@media(max-width:520px){
  .form-grid{grid-template-columns:1fr;}
  .btn-primary{grid-column:span 1;}
  h1{font-size:20px;}
  table{font-size:13px;}
  .chart-container{height:260px;}
}
/* Proper spacing between Edit and Delete on mobile */
@media (max-width: 520px) {
  td:last-child {
    display: flex !important;
    justify-content: center;
    gap: 10px !important;
  }

  .btn-edit, .btn-delete {
    margin-right: 0 !important; /* ensure gap handles spacing */
  }
}

</style>
</head>

<body>
<div class="wrap">
<div class="card">

<h1>Monthly / Yearly Savings Calculator</h1>

<!-- FORM -->
<div class="form-grid" id="mainFormGrid">
  <div class="field">
    <label>Date</label>
    <input id="dateInput" type="date">
  </div>

  <div class="field">
    <label>Product</label>
    <input id="productInput" type="text" placeholder="Product name...">
  </div>

  <div class="field">
    <label>Credit</label>
    <input id="creditInput" type="number" value="0">
  </div>

  <div class="field">
    <label>Debit</label>
    <input id="debitInput" type="number" value="0">
  </div>

  <button class="btn btn-primary" id="addBtn">Add Entry</button>

  <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center;">
    <label style="font-weight:700;color:var(--muted);">Filter</label>
    <select id="monthFilter"><option value="all">All</option></select>
    <button class="btn small-btn" id="clearFilter">Clear</button>
    <button class="btn small-btn" id="toggleGraph">Show Graphs</button>
  </div>
</div>

<!-- TABLE -->
<div class="table-wrap">
<table>
  <thead>
    <tr>
      <th>Date</th>
      <th>Product</th>
      <th>Credit</th>
      <th>Debit</th>
      <th>Total</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody id="tableBody"></tbody>
</table>
</div>

<!-- REPORT -->
<div class="report">
  <div id="reportContent"><strong>No data yet.</strong></div>
</div>

<!-- GRAPH SECTION -->
<div class="graph-panel" id="graphPanel">

  <div class="tabs">
    <div class="tab active" id="tabMonthly">Monthly</div>
    <div class="tab" id="tabYearly">Yearly</div>
  </div>

  <div style="margin-top:10px;display:flex;gap:10px;flex-wrap:wrap;align-items:center;">
    <label>Graph Year</label>
    <select id="graphYearSelect"></select>
  </div>

  <div class="chart-container">
    <canvas id="chartCanvas"></canvas>
  </div>

</div>

</div>
</div>

<!-- MODAL -->
<div class="modal-backdrop" id="modalBackdrop">
  <div class="modal">
    <h3>Edit Entry</h3>

    <label>Date</label>
    <input id="editDate" type="date">

    <label style="margin-top:8px;">Product</label>
    <input id="editProduct" type="text">

    <div style="display:flex;gap:8px;margin-top:8px;">
      <div style="flex:1;">
        <label>Credit</label>
        <input id="editCredit" type="number">
      </div>
      <div style="flex:1;">
        <label>Debit</label>
        <input id="editDebit" type="number">
      </div>
    </div>

    <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px;">
      <button class="btn small-btn" id="cancelEdit">Cancel</button>
      <button class="btn small-btn btn-primary" id="saveEdit">Save</button>
    </div>
  </div>
</div>

<script>
/* DATA STORAGE */
const LS_KEY = 'spendData_v1';
let data = JSON.parse(localStorage.getItem(LS_KEY)) || [];

/* DOM ELEMENTS */
const tableBody = document.getElementById("tableBody");
const addBtn = document.getElementById("addBtn");
const dateInput = document.getElementById("dateInput");
const productInput = document.getElementById("productInput");
const creditInput = document.getElementById("creditInput");
const debitInput = document.getElementById("debitInput");
const reportContent = document.getElementById("reportContent");
const monthFilter = document.getElementById("monthFilter");
const clearFilter = document.getElementById("clearFilter");
const toggleGraph = document.getElementById("toggleGraph");
const graphPanel = document.getElementById("graphPanel");
const tabMonthly = document.getElementById("tabMonthly");
const tabYearly = document.getElementById("tabYearly");
const graphYearSelect = document.getElementById("graphYearSelect");
const chartCanvas = document.getElementById("chartCanvas");

const modalBackdrop = document.getElementById("modalBackdrop");
const editDate = document.getElementById("editDate");
const editProduct = document.getElementById("editProduct");
const editCredit = document.getElementById("editCredit");
const editDebit = document.getElementById("editDebit");
const saveEdit = document.getElementById("saveEdit");
const cancelEdit = document.getElementById("cancelEdit");

let editingIndex = null;
let activeTab = "monthly";
let currentFilter = "all";
let chart = null;

/* HELPERS */
function saveData(){
  localStorage.setItem(LS_KEY, JSON.stringify(data));
}
function fmt(n){ return Number(n).toLocaleString(); }
function monthKey(date){ const d=new Date(date); return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}`; }

/* FILTER DROPDOWN */
function refreshMonthFilter(){
  const months=new Set(data.map(x=>monthKey(x.date)));
  const sorted=[...months].sort((a,b)=>b.localeCompare(a));
  monthFilter.innerHTML='<option value=\"all\">All</option>';
  sorted.forEach(m=>{
    const [y,mo]=m.split('-');
    const name=new Date(y,mo-1).toLocaleString(undefined,{month:'short'});
    const opt=document.createElement('option');
    opt.value=m;
    opt.textContent=`${y} - ${name}`;
    monthFilter.appendChild(opt);
  });
}

/* RENDER TABLE */
function getFiltered(){
  return currentFilter==="all"? data : data.filter(x=>monthKey(x.date)===currentFilter);
}

function renderTable(){
  const rows=getFiltered();
  tableBody.innerHTML='';

  if(rows.length===0){
    tableBody.innerHTML='<tr><td colspan=\"6\" style=\"padding:20px;\">No entries</td></tr>';
    updateReport();
    return;
  }

  rows.forEach(item=>{
    const idx=data.indexOf(item);
    const total=item.credit-item.debit;
    const totalClass =
      total>0 ? "total-positive" :
      total<0 ? "total-negative" :
      "total-zero";

    const tr=document.createElement('tr');
    tr.innerHTML=`
      <td>${item.date}</td>
      <td style="text-align:left;padding-left:12px;">${item.product}</td>
      <td class="credit">+ ₹${fmt(item.credit)}</td>
      <td class="debit">- ₹${fmt(item.debit)}</td>
      <td class="${totalClass}">₹${fmt(total)}</td>
      <td>
        <button class="small-btn btn-edit" data-action="edit" data-idx="${idx}">Edit</button>
        <button class="small-btn btn-delete" data-action="delete" data-idx="${idx}">Delete</button>
      </td>
    `;
    tableBody.appendChild(tr);
  });

  updateReport();
}

/* REPORT */
function updateReport(){
  const rows=getFiltered();
  if(rows.length===0){
    reportContent.innerHTML='<strong>No data yet.</strong>';
    return;
  }

  const totalCredit = rows.reduce((s,r)=>s+Number(r.credit),0);
  const totalDebit = rows.reduce((s,r)=>s+Number(r.debit),0);
  const net = totalCredit-totalDebit;

  reportContent.innerHTML = `
    <strong>Total Credit:</strong> 
    <span style="color:var(--green)">₹${fmt(totalCredit)}</span>
    &nbsp; | &nbsp;

    <strong>Total Debit:</strong> 
    <span style="color:var(--red)">₹${fmt(totalDebit)}</span>
    &nbsp; | &nbsp;

    <strong>Net Savings:</strong> 
    <span style="color:var(--green)">₹${fmt(net)}</span>
  `;
}

/* ADD ENTRY */
addBtn.addEventListener('click',e=>{
  e.preventDefault();

  const d = dateInput.value || new Date().toISOString().slice(0,10);
  const p = productInput.value.trim() || "—";
  const c = Number(creditInput.value||0);
  const db = Number(debitInput.value||0);

  data.push({date:d,product:p,credit:c,debit:db});
  saveData();

  dateInput.value=""; productInput.value=""; creditInput.value=0; debitInput.value=0;

  refreshMonthFilter();
  renderTable();
  populateGraphYears();
  updateChartIfVisible();
});

/* EDIT / DELETE */
tableBody.addEventListener("click",ev=>{
  const btn = ev.target.closest("button");
  if(!btn) return;
  const idx = Number(btn.dataset.idx);

  if(btn.dataset.action==="delete"){
    if(!confirm("Delete this entry?")) return;
    data.splice(idx,1);
    saveData();
    refreshMonthFilter(); renderTable(); populateGraphYears(); updateChartIfVisible();
  }
  else if(btn.dataset.action==="edit"){
    editingIndex=idx;
    const it=data[idx];
    editDate.value=it.date;
    editProduct.value=it.product;
    editCredit.value=it.credit;
    editDebit.value=it.debit;
    modalBackdrop.style.display="flex";
  }
});

/* MODAL */
cancelEdit.addEventListener("click",()=>{
  modalBackdrop.style.display="none";
  editingIndex=null;
});

saveEdit.addEventListener("click",()=>{
  const d=editDate.value;
  const p=editProduct.value.trim();
  const c=Number(editCredit.value);
  const db=Number(editDebit.value);

  data[editingIndex]={date:d,product:p,credit:c,debit:db};
  saveData();

  modalBackdrop.style.display="none";
  editingIndex=null;

  refreshMonthFilter(); renderTable(); populateGraphYears(); updateChartIfVisible();
});

/* FILTER */
monthFilter.addEventListener("change",()=>{
  currentFilter=monthFilter.value;
  renderTable(); updateChartIfVisible();
});
clearFilter.addEventListener("click",()=>{
  monthFilter.value="all";
  currentFilter="all";
  renderTable(); updateChartIfVisible();
});

/* GRAPH */
toggleGraph.addEventListener("click",()=>{
  if(graphPanel.style.display==="none"||graphPanel.style.display===""){
    graphPanel.style.display="block";
    toggleGraph.textContent="Hide Graphs";
    updateChart();
  } else {
    graphPanel.style.display="none";
    toggleGraph.textContent="Show Graphs";
  }
});

tabMonthly.addEventListener("click",()=>{ setTab("monthly"); });
tabYearly.addEventListener("click",()=>{ setTab("yearly"); });

function setTab(t){
  activeTab=t;
  tabMonthly.classList.toggle("active",t==="monthly");
  tabYearly.classList.toggle("active",t==="yearly");
  updateChart();
}

/* YEAR DROPDOWN */
function populateGraphYears(){
  const years=new Set(data.map(x=>new Date(x.date).getFullYear()));
  const sorted=[...years].sort((a,b)=>b-a);

  graphYearSelect.innerHTML="";
  sorted.forEach(y=>{
    const opt=document.createElement("option");
    opt.value=y;
    opt.textContent=y;
    graphYearSelect.appendChild(opt);
  });
}
graphYearSelect.addEventListener("change",()=>{ if(activeTab==="monthly") updateChart(); });

/* AGGREGATE */
function aggMonthly(year){
  const credit=Array(12).fill(0);
  const debit=Array(12).fill(0);

  data.forEach(x=>{
    const d=new Date(x.date);
    if(d.getFullYear()===Number(year)){
      const m=d.getMonth();
      credit[m]+=Number(x.credit);
      debit[m]+=Number(x.debit);
    }
  });

  return {
    labels:[...Array(12)].map((_,i)=>new Date(year,i).toLocaleString(undefined,{month:'short'})),
    credit,debit,balance:credit.map((c,i)=>c-debit[i])
  };
}

function aggYearly(){
  const map={};
  data.forEach(x=>{
    const y=new Date(x.date).getFullYear();
    if(!map[y]) map[y]={credit:0,debit:0};
    map[y].credit+=Number(x.credit);
    map[y].debit+=Number(x.debit);
  });

  const years=Object.keys(map).map(Number).sort((a,b)=>a-b);

  return {
    labels:years,
    credit:years.map(y=>map[y].credit),
    debit:years.map(y=>map[y].debit),
    balance:years.map(y=>map[y].credit-map[y].debit)
  };
}

/* CHART */
function updateChart(){
  if(!chart){
    chart=new Chart(chartCanvas.getContext("2d"),{
      type:"line",
      data:{},
      options:{
        responsive:true,
        maintainAspectRatio:false,
        interaction:{mode:"index",intersect:false},
        scales:{y:{beginAtZero:true}}
      }
    });
  }

  if(activeTab==="monthly"){
    const year=Number(graphYearSelect.value);
    const ag=aggMonthly(year);

    chart.data={
      labels:ag.labels,
      datasets:[
        {label:"Credit",data:ag.credit,borderColor:"#16a34a",backgroundColor:"rgba(22,163,74,0.1)",fill:true},
        {label:"Debit",data:ag.debit,borderColor:"#ef4444",backgroundColor:"rgba(239,68,68,0.1)",fill:true},
        {label:"Balance",data:ag.balance,borderColor:"#2563eb"}
      ]
    };
  }
  else{
    const ag=aggYearly();
    chart.data={
      labels:ag.labels,
      datasets:[
        {label:"Credit",data:ag.credit,borderColor:"#16a34a",backgroundColor:"rgba(22,163,74,0.1)",fill:true},
        {label:"Debit",data:ag.debit,borderColor:"#ef4444",backgroundColor:"rgba(239,68,68,0.1)",fill:true},
        {label:"Balance",data:ag.balance,borderColor:"#2563eb"}
      ]
    };
  }

  chart.update();
}

function updateChartIfVisible(){
  if(graphPanel.style.display==="block") updateChart();
}

/* INIT */
refreshMonthFilter();
renderTable();
populateGraphYears();
</script>

</body>
</html>
